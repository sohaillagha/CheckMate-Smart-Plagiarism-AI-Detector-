Hierarchical Attentional Hybrid Neural Networks for Document Classiﬁcation Jader Abreu⋆, Luis Fred⋆, David Macˆedo, and Cleber Zanchettin Centro de Inform´atica Universidade Federal de Pernambuco 50.740-560, Recife, PE, Brazil {jaoa,lfgs,dlm,cz}@cin.ufpe.br Abstract. Document classiﬁcation is a challenging task with important applications. The deep learning approaches to the problem have gained much attention recently. Despite the progress, the proposed models do not incorporate the knowledge of the document structure in the architec- ture eﬃciently and not take into account the contexting importance of words and sentences. In this paper, we propose a new approach based on a combination of convolutional neural networks, gated recurrent units, and attention mechanisms for document classiﬁcation tasks. The main contribution of this work is the use of convolution layers to extract more meaningful, generalizable and abstract features by the hierarchical rep- resentation. The proposed method in this paper improves the results of the current attention-based approaches. Keywords: Text classiﬁcation · Attention mechanisms · Document clas- siﬁcation · Convolutional Neural Networks. 1 Introduction Text classiﬁcation is one of the most classical and important tasks in the ma- chine learning ﬁeld. The document classiﬁcation, which is essential to organize documents for retrieval, analysis, and curation, is traditionally performed by classiﬁers such as Support Vector Machines or Random Forests. As in diﬀerent areas, the deep learning methods are presenting a performance quite superior to traditional approaches in this ﬁeld [5]. Deep learning is also playing a central role in Natural Language Processing (NLP) through learned word vector repre- sentations. It aims to represent words in terms of ﬁxed-length, continuous and dense feature vectors, capturing semantic word relations: similar words are close to each other in the vector space. In most NLP tasks for document classiﬁcation, the proposed models do not incorporate the knowledge of the document structure in the architecture eﬃ- ciently and not take into account the contexting importance of words and sen- tences. Much of these approaches do not select qualitative or informative words ⋆Authors contributed equally and are both ﬁrst authors. arXiv:1901.06610v2 [cs.CL] 28 Jun 2019 2 Abreu, J., Fred, L., et al. and sentences since some words are more informative than others in a docu- ment. Moreover, these models are frequently based on recurrent neural networks only [6]. Since CNN has leveraged strong performance on deep learning models by extracting more abundant features and reducing the number of parameters, we guess it not only improves computational performance but also yields better generalization on neural models for document classiﬁcation. A recent trend in NLP is to use attentional mechanisms to modeling informa- tion dependencies without regard to their distance between words in the input sequences. In [6] is proposed a hierarchical neural architecture for document classiﬁcation, which employs attentional mechanisms, trying to mirror the hier- archical structure of the document. The intuition underlying the model is that not all parts of a text are equally relevant to represent it. Further, determining the relevant sections involves modeling the interactions and importance among the words and not just their presence in the text. In this paper, we propose a new approach for document classiﬁcation based on CNN, GRU [4] hidden units and attentional mechanisms to improve the model performance by selectively focusing the network on essential parts of the text sentences during the model training. Inspired by [6], we have used the hi- erarchical concept to better representation of document structure. We call our model as Hierarchical Attentional Hybrid Neural Networks (HAHNN). We also used temporal convolutions [2], which give us more ﬂexible receptive ﬁeld sizes. We evaluate the proposed approach comparing its results with state-of-the-art models and the model shows an improved accuracy. 2 Hierarchical Attentional Hybrid Neural Networks The HAHNN model combines convolutional layers, Gated Recurrent Units, and attention mechanisms. Figure 1 shows the proposed architecture. The ﬁrst layer of HAHNN is a pre-processed word embedding layer (black circles in the Fig- ure 1). The second layer contains a stack of CNN layers that consist of con- volutional layers with multiple ﬁlters (varying window sizes) and feature maps. We also have performed some trials with temporal convolutional layers with di- lated convolutions and gotten promising results. Besides, we used Dropout for regularization. In the next layers, we use a word encoder applying the attention mechanism on word level context vector. In sequence, a sentence encoder apply- ing the attention on sentence-level context vector. The last layer uses a Softmax function to generate the output probability distribution over the classes. We use CNN to extract more meaningful, generalizable and abstract features by the hierarchical representation. Combining convolutional layers in diﬀerent ﬁlter sizes with both word and sentence encoder in a hierarchical architecture let our model extract more rich features and improves generalization performance in document classiﬁcation. To obtain representations of more rare words, by taking into account subwords information, we used FastText [3] in the word embedding initialization. We investigate two variants of the proposed architecture. There is a basic ver- sion, as described in Figure 1, and there is another which implements a TCN [2] Title Suppressed Due to Excessive Length 3 layer. The goal is to simulate RNNs with very long memory size by adopting a combination of dilated and regular convolutions with residual connections. Di- lated convolutions are considered beneﬁcial in longer sequences as they enable an exponentially larger receptive ﬁeld in convolutional layers. More formally, for a 1-D sequence input x ∈Rn and a ﬁlter f : {0, ..., k −1} →R, the dilated convolution operation F on element s of the sequence is deﬁned as F(s) = (x ∗d f)(s) = k−1 X i=o f(i) · xs−d·i (1) where d is the dilatation factor, k is the ﬁlter size, and s −d · i accounts for the past information direction. Dilation is thus equivalent to introducing a ﬁxed step between every two adjacent ﬁlter maps. When d = 1, a dilated convolution reduces to a regular convolution. The use of larger dilation enables an output at the top level to represent a wider range of inputs, expanding the receptive ﬁeld. Fig. 1: Our HAHNN Architecture include an CNN layer after the embedding layer. In addition, we have created a variant which includes a temporal convo- lutional layer [2] after the embedding layer. The proposed model takes into account that the diﬀerent parts of a docu- ment have no similar relevant information. Moreover, determining the relevant sections involves modeling the interactions among the words, not just their iso- lated presence in the text. Therefore, to consider this aspect, the model includes two levels of attention mechanisms [1]. One structure at the word level and other at the sentence level, which let the model pay more or less attention to individual words and sentences when constructing the document representation. 4 Abreu, J., Fred, L., et al. The strategy consists of diﬀerent parts: 1) A word sequence encoder and a word-level attention layer; and 2) A sentence encoder and a sentence-level attention layer. In the word encoder, the model uses bidirectional GRU [1] to produce annotations of words by summarizing information from both directions. Therefore, it incorporates the contextual information in the annotation. The attention levels let the model pay more or less attention to individual words and sentences when constructing the representation of the document [6]. Given a sentence with words wit, t ∈[0, T] and an embedding matrix We, a bidirectional GRU contains the forward GRU−→f which reads the sentence si from wi1 to wiT and a backward GRU←−f which reads from wiT to wi1: xit = Wewit, t ∈[1, T], (2) −→ hit = −−−→ GRU(xit), t ∈[1, T], (3) ←− hit = ←−−− GRU(xit), t ∈[T, 1]. (4) An annotation for a given word wit is obtained by concatenating the forward hidden state and backward hidden state, i.e., hit = [−→ hit, ←− hit], which summarizes the information of the whole sentence. We use the attention mechanism to eval- uates words that are important to the meaning of the sentence and to aggregate the representation of those informative words into a sentence vector. Speciﬁcally, uit = tanh(Wwhit + bw) (5) αit = exp(u⊤ ituw) P t exp(u⊤ ituw) (6) si = X αithit (7) The model measures the importance of a word as the similarity of uit with a word level context vector uw and learns a normalized importance weight αit through a softmax function. After that, the architecture computes the sentence vector si as a weighted sum of the word annotations based on the weights. The word context vector uw is randomly initialized and jointly learned during the training process. Given the sentence vectors si, and the document vector, the sentence atten- tion is obtained as: −→ hit = −−−→ GRU(si), i ∈[1, L], (8) ←− hit = ←−−− GRU(si), i ∈[L, 1]. (9) The proposed solution concatenates hi = [−→ hi, ←− hi] hi which summarizes the neighbor sentences around sentence i but still focus on sentence i. To reward sentences that are relevant to correctly classify a document, the solution again use attention mechanism and introduce a sentence level context vector us using it to measure the importance of the sentences: uit = tanh(Wshi + bs) (10) αit = exp(u⊤ i us) P i exp(u⊤ i us) (11) v = X αihi (12) In the above equation, v is the document vector that summarizes all the in- formation of sentences in a document. Similarly, the sentence level context vector us can be randomly initialized and jointly learned during the training process. The output of the sentence attention layer feeds a fully connected softmax layer. Title Suppressed Due to Excessive Length 5 It gives us a probability distribution over the classes. The proposed method is openly available in the github repository 1. 3 Experiments and Results We evaluate the proposed model on two document classiﬁcation datasets using 90% of the data for training and the remaining 10% for tests. We split docu- ments into sentences and tokenize each sentence. The word embeddings have dimension 200 and we use Adam optimizer with a learning rate of 0.001. The datasets used are the IMDb Movie Reviews 2 and Yelp 2018 3. The former con- tains a set of 25k highly polar movie reviews for training and 25k for testing, whereas the classiﬁcation involves detecting positive/negative reviews. The lat- ter include users ratings and write reviews about stores and services on Yelp, being a dataset for multiclass classiﬁcation (ratings from 0-5 stars). Yelp 2018 contains around 5M full review text data, but we ﬁx in 500k the number of used samples for computational purposes. Table 1: Results in classiﬁcation accuracies. Method Accuracy on test set Yelp 2018 (ﬁve classes) IMDb (two classes) VDNN [7] 62.14 79.47 HN-ATT [6] 72.73 89.02 CNN [5] 71.81 91.34 Our model with CNN 73.28 92.26 Our model with TCN 72.63 95.17 Table 1 shows the experiment results comparing our results with related works. Note that HN-ATT [6] obtained an accuracy of 72,73% in the Yelp test set, whereas the proposed model obtained an accuracy of 73,28%. Our results also outperformed CNN [6] and VDNN [7]. We can see an improvement of the results in Yelp with our approach using CNN and varying window sizes in ﬁlters. The model also performs better in the results with IMDb using both CNN and TCN. 3.1 Attention Weights Visualizations To validate the model performance in select informative words and sentences, we present the visualizations of attention weights in Figure 2. There is an example of the attention visualizations for a positive and negative class in test reviews. Every line is a sentence. Blue color denotes the sentence weight, and red denotes the word weight in determining the sentence meaning. There is a greater focus on more important features despite some exceptions. For example, the word “loving” and “amazed” in Figure 2 (a) and “disappointment” in Figure 2 (b). 1 https://github.com/luisfredgs/cnn-hierarchical-network-for-document-classiﬁcation 2 http://ai.stanford.edu/ amaas/data/sentiment/ 3 https://www.yelp.com/dataset/challenge 6 Abreu, J., Fred, L., et al. (a) A positive example of visualization of a strong word in the sentence. (b) A negative example of visualization of a strong word in the sentence. Fig. 2: Visualization of attention weights computed by the proposed model Occasionally, we have found issues in some sentences, where fewer important words are getting higher importance. For example, in Figure 2 (a) notes that the word “translate” has received high importance even though it represents a neutral word. These drawbacks will be taken into account in future works. 4 Final Remarks In this paper, we have presented the HAHNN architecture for document classi- ﬁcation. The method combines CNN with attention mechanisms in both word and sentence level. HAHNN improves accuracy in document classiﬁcation by incorporate the document structure in the model and employing CNN’s for the extraction of more abundant features. References 1. BAHDANAU, Dzmitry; CHO, Kyunghyun; BENGIO, Yoshua. Neural ma- chine translation by jointly learning to align and translate. arXiv preprint arXiv:1409.0473, 2014. 2. BAI, Shaojie; KOLTER, J. Zico; KOLTUN, Vladlen. An empirical evaluation of generic convolutional and recurrent networks for sequence modeling. arXiv preprint arXiv:1803.01271, 2018. 3. BOJANOWSKI, Piotr et al. Enriching word vectors with subword information. arXiv preprint arXiv:1607.04606, 2016. 4. CHO, Kyunghyun et al. Learning phrase representations using RNN encoder- decoder for statistical machine translation. arXiv preprint arXiv:1406.1078, 2014. 5. KIM, Yoon. Convolutional neural networks for sentence classiﬁcation. arXiv preprint arXiv:1408.5882, 2014. 6. YANG, Zichao et al. Hierarchical attention networks for document classiﬁcation. In: Conf. North Am. Chapter of the Assoc. for Comp. Ling. 2016. p.1480-1489, San Diego, CA, USA. 7. Conneau, Alexis, et al. ”Very deep convolutional networks for text classiﬁcation.” arXiv preprint arXiv:1606.01781 (2016).